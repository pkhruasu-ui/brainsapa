describe("state",function(){function u(e,t,n,r,o){s&&(i+=e.name+"("+t.name+","+r.name+");")}function a
(e){return function(){o&&(i+=this.name+"."+e+";")}}function x(e){return jasmine.getEnv().currentSpec.
$injector.get(e)}function T(e,t){var n=x("$state"),r=x("$q");n.transitionTo(e,t||{}),r.flush(),expect
(n.current).toBe(e)}var e,t,n,r;beforeEach(module("ui.router",function(e){t=e,e.html5Mode(!1)}));var i
,s,o,f={data:{},controller:function(){i+="controller;"}},l={},c={},h={params:{x:null,y:null}},p={parent
:h,params:{x:null,y:null,z:null}},d={parent:h,controller:function(){},template:"hey"},v={params:{i:{}
}},m={data:{propA:"propA",propB:"propB"}},g={parent:m},y={parent:g,data:{propA:"overriddenA",propC:"propC"
}},b={url:"^/search?term",reloadOnSearch:!1},w={url:"/opt/:param",params:{param:"100"}},E={url:"/opt2/:param2/:param3"
,params:{param3:"300",param4:"400"}},S={};beforeEach(module(function(t,s){angular.forEach([f,l,c,h,p,
v,m,g,y],function(e){e.onEnter=a("onEnter"),e.onExit=a("onExit")}),e=t,t.state("A",f).state("B",l).state
("C",c).state("D",h).state("DD",p).state("DDDD",d).state("E",v).state("H",m).state("HH",g).state("HHH"
,y).state("OPT",w).state("OPT.OPT2",E).state("RS",b).state("home",{url:"/"}).state("home.item",{url:"front/:id"
}).state("about",{url:"/about"}).state("about.person",{url:"/:person"}).state("about.person.item",{url
:"/:id"}).state("about.sidebar",{}).state("about.sidebar.item",{url:"/:item",templateUrl:function(e){
return n=e,"/templates/"+e.item+".html"}}).state("dynamicController",{url:"/dynamic/:type",template:"test"
,controllerProvider:function(e){return r=e.type+"Controller",r}}).state("home.redirect",{url:"redir",
onEnter:function(e){e.transitionTo("about")}}).state("resolveFail",{url:"/resolve-fail",resolve:{badness
:function(e){return e.reject("!")}}}).state("resolveTimeout",{url:"/:foo",resolve:{value:function(e){
return e(function(){i+="Success!"},1)}},controller:function(){i+="controller;"}}).state("badParam",{url
:"/bad/{param:int}"}).state("badParam2",{url:"/bad2/{param:[0-9]{5}}"}).state("json",{url:"/jsonstate/{param:json}"
}).state("first",{url:"^/first/subpath"}).state("second",{url:"^/second"}).state("root",{url:"^/root?param1"
}).state("root.sub1",{url:"/1?param2"}),t.state("root.sub2",{url:"/2?param2"}),s.value("AppInjectable"
,S)})),beforeEach(inject(function(e){i="",s=o=!1,e.$on("$stateChangeStart",u),e.$on("$stateChangeSuccess"
,u),e.$on("$stateChangeError",u),e.$on("$stateNotFound",u)})),describe("provider",function(){it("should ignore Object properties when registering states"
,function(){expect(function(){e.state("toString",{url:"/to-string"})}).not.toThrow(),expect(function(
){e.state("watch",{url:"/watch"})}).not.toThrow()})}),describe(".transitionTo()",function(){it("returns a promise for the target state"
,inject(function(e,t){var n=e.transitionTo(f,{});t.flush(),expect(resolvedValue(n)).toBe(f)})),it("allows transitions by name"
,inject(function(e,t){e.transitionTo("A",{}),t.flush(),expect(e.current).toBe(f)})),it("doesn't trigger state change if reloadOnSearch is false"
,inject(function(e,t,n,r){T(b),n.search({term:"hello"});var i;r.$on("$stateChangeStart",function(e,t,
n,r,s){i=!0}),t.flush(),expect(n.search()).toEqual({term:"hello"}),expect(i).toBeFalsy()})),it("ignores non-applicable state parameters"
,inject(function(e,t){e.transitionTo("A",{w00t:"hi mom!"}),t.flush(),expect(e.current).toBe(f)})),it("triggers $stateChangeStart"
,inject(function(e,t,n){T(v,{i:"iii"});var r;n.$on("$stateChangeStart",function(t,n,i,s,o){expect(s).
toBe(v),expect(o).toEqual({i:"iii"}),expect(n).toBe(h),expect(i).toEqual({x:"1",y:"2"}),expect(e.current
).toBe(s),expect(e.params).toEqual(o),r=!0}),e.transitionTo(h,{x:"1",y:"2"}),t.flush(),expect(r).toBeTruthy
(),expect(e.current).toBe(h)})),it("can be cancelled by preventDefault() in $stateChangeStart",inject
(function(e,t,n){T(f);var r;n.$on("$stateChangeStart",function(e){e.preventDefault(),r=!0});var i=e.transitionTo
(l,{});t.flush(),expect(r).toBeTruthy(),expect(e.current).toBe(f),expect(resolvedError(i)).toBeTruthy
()})),it("triggers $stateNotFound",inject(function(e,t,n){T(v,{i:"iii"});var r;n.$on("$stateNotFound"
,function(t,n,i,s){expect(i).toBe(v),expect(s).toEqual({i:"iii"}),expect(n.to).toEqual("never_defined"
),expect(n.toParams).toEqual({x:"1",y:"2"}),expect(e.current).toBe(i),expect(e.params).toEqual(s),r=!0
});var i;try{e.transitionTo("never_defined",{x:"1",y:"2"})}catch(s){i=s.message}t.flush(),expect(i).toEqual
("No such state 'never_defined'"),expect(r).toBeTruthy(),expect(e.current).toBe(v)})),it("can be cancelled by preventDefault() in $stateNotFound"
,inject(function(e,t,n){T(f);var r;n.$on("$stateNotFound",function(e){e.preventDefault(),r=!0});var i=
e.transitionTo("never_defined",{});t.flush(),expect(r).toBeTruthy(),expect(e.current).toBe(f),expect(
resolvedError(i)).toBeTruthy()})),it("can be redirected in $stateNotFound",inject(function(e,t,n){T(f
);var r;n.$on("$stateNotFound",function(e,t){t.to=h,t.toParams={x:"1",y:"2"},r=!0});var i=e.transitionTo
("never_defined",{z:3});t.flush(),expect(r).toBeTruthy(),expect(e.current).toBe(h),expect(e.params).toEqual
({x:"1",y:"2"})})),it("can lazy-define a state in $stateNotFound",inject(function(t,n,r){T(p,{x:"1",y
:"2",z:"3"});var i;r.$on("$stateNotFound",function(t,n){e.state(n.to,{parent:p,params:{x:{},y:{},z:{}
,w:{}}}),i=!0});var s=t.go("DDD",{w:"4"});n.flush(),expect(i).toBeTruthy(),expect(t.current.name).toEqual
("DDD"),expect(t.params).toEqual({x:"1",y:"2",z:"3",w:"4"})})),it("can defer a state transition in $stateNotFound"
,inject(function(t,n,r){T(f);var i,s=n.defer();r.$on("$stateNotFound",function(e,t){e.retry=s.promise
,i=!0});var o=t.go("AA",{a:"1"});e.state("AA",{parent:f,params:{a:{}}}),s.resolve(),n.flush(),expect(
i).toBeTruthy(),expect(t.current.name).toEqual("AA"),expect(t.params).toEqual({a:"1"})})),it("can defer and supersede a state transition in $stateNotFound"
,inject(function(t,n,r){T(f);var i,s=n.defer();r.$on("$stateNotFound",function(e,t){e.retry=s.promise
,i=!0});var o=t.go("AA",{a:1});t.go(l),e.state("AA",{parent:f,params:{a:{}}}),s.resolve(),n.flush(),expect
(i).toBeTruthy(),expect(t.current).toEqual(l),expect(t.params).toEqual({})})),it("triggers $stateChangeSuccess"
,inject(function(e,t,n){T(v,{i:"iii"});var r;n.$on("$stateChangeSuccess",function(t,n,i,s,o){expect(s
).toBe(v),expect(o).toEqual({i:"iii"}),expect(n).toBe(h),expect(i).toEqual({x:"1",y:"2"}),expect(e.current
).toBe(n),expect(e.params).toEqual(i),r=!0}),e.transitionTo(h,{x:"1",y:"2"}),t.flush(),expect(r).toBeTruthy
(),expect(e.current).toBe(h)})),it("does not trigger $stateChangeSuccess or $viewContentLoading when suppressed, but changes state"
,inject(function(e,t,n,r){T(v,{i:"iii"});var i;n.$on("$stateChangeSuccess",function(){i=!0}),n.$on("$viewContentLoading"
,function(e,t){i=!0}),e.transitionTo(d,{},{notify:!1}),t.flush(),expect(i).toBeFalsy(),expect(e.current
).toBe(d)})),it("does not trigger $stateChangeSuccess when suppressed, but updates params",inject(function(
e,t,n){T(v,{x:"iii"});var r;n.$on("$stateChangeSuccess",function(){r=!0}),e.transitionTo(v,{i:"1",y:"2"
},{notify:!1}),t.flush(),expect(r).toBeFalsy(),expect(e.params.i).toBe("1"),expect(e.current).toBe(v)
})),it("is a no-op when passing the current state and identical parameters",inject(function(e,t){T(f)
;var n=e.transitionTo(f,{});expect(n).toBeDefined(),t.flush(),expect(resolvedValue(n)).toBe(f),expect
(e.current).toBe(f),expect(i).toBe("")})),it("aborts pending transitions (last call wins)",inject(function(
e,t){T(f),s=!0;var n=e.transitionTo(l,{});e.transitionTo(c,{}),t.flush(),expect(e.current).toBe(c),expect
(resolvedError(n)).toBeTruthy(),expect(i).toBe("$stateChangeStart(B,A);$stateChangeStart(C,A);$stateChangeSuccess(C,A);"
)})),it("aborts pending transitions even when going back to the current state",inject(function(e,t){T
(f),s=!0;var n=e.transitionTo(l,{});e.transitionTo(f,{}),t.flush(),expect(e.current).toBe(f),expect(resolvedError
(n)).toBeTruthy(),expect(i).toBe("$stateChangeStart(B,A);")})),it("aborts pending transitions when aborted from callbacks"
,inject(function(e,t){var n=e.transitionTo("home.redirect");t.flush(),expect(e.current.name).toBe("about"
)})),it("triggers onEnter and onExit callbacks",inject(function(e,t){T(f),o=!0,e.transitionTo(h,{}),t
.flush(),i+=e.current.name+";",e.transitionTo(p,{}),t.flush(),i+=e.current.name+";",e.transitionTo(f,
{}),t.flush(),expect(i).toBe("A.onExit;D.onEnter;D;DD.onEnter;DD;DD.onExit;D.onExit;A.onEnter;")})),it
("doesn't transition to parent state when child has no URL",inject(function(e,t){e.transitionTo("about.sidebar"
),t.flush(),expect(e.current.name).toEqual("about.sidebar")})),it("notifies on failed relative state resolution"
,inject(function(e,t){e.transitionTo(p),t.flush();var n="Could not resolve '^.Z' from state 'DD'";expect
(function(){e.transitionTo("^.Z",null,{relative:e.$current})}).toThrow(n)})),it("uses the controllerProvider to get controller dynamically"
,inject(function(e,t){e.transitionTo("dynamicController",{type:"Acme"}),t.flush(),expect(r).toEqual("AcmeController"
)}))}),describe(".go()",function(){it("transitions to a relative state",inject(function(e,t){e.transitionTo
("about.person.item",{person:"bob",id:5}),t.flush(),e.go("^.^.sidebar"),t.flush(),expect(e.$current.name
).toBe("about.sidebar"),e.go("home"),t.flush(),expect(e.$current.name).toBe("home"),e.go(".item",{id:5
}),t.flush(),expect(e.$current.name).toBe("home.item"),e.go("^.^.about"),t.flush(),expect(e.$current.
name).toBe("about"),e.go(".person.item",{person:"bob",id:13}),t.flush(),expect(e.$current.name).toBe("about.person.item"
),e.go("^"),t.flush(),expect(e.$current.name).toBe("about.person"),e.go("^.sidebar"),t.flush(),expect
(e.$current.name).toBe("about.sidebar")})),it("keeps parameters from common ancestor states",inject(function(
e,t,n){e.transitionTo("about.person",{person:"bob"}),n.flush(),e.go(".item",{id:"5"}),n.flush(),expect
(e.$current.name).toBe("about.person.item"),expect(t).toEqual({person:"bob",id:"5"}),e.go("^.^.sidebar"
),n.flush(),expect(e.$current.name).toBe("about.sidebar")}))}),describe(".reload()",function(){it("returns a promise for the state transition"
,inject(function(e,t){var n=e.transitionTo(f,{});t.flush(),expect(resolvedValue(n)).toBe(f),n=e.reload
(),t.flush(),expect(resolvedValue(n)).toBe(f)})),it("should reload the current state with the current parameters"
,inject(function(e,t,n){e.transitionTo("resolveTimeout",{foo:"bar"}),t.flush(),expect(i).toBe(""),n.flush
(),expect(i).toBe("Success!"),e.reload(),t.flush(),n.flush(),expect(i).toBe("Success!Success!")})),it
("should invoke the controller",inject(function(e,t,n,r,s){s("<div> <div ui-view/> </div>")(r),e.transitionTo
("resolveTimeout",{foo:"bar"}),n.flush(),t.flush(),expect(i).toBe("Success!controller;"),e.reload(),n
.flush(),t.flush(),expect(i).toBe("Success!controller;Success!controller;")}))}),describe(".is()",function(
){it("should return true when the current state is passed",inject(function(e,t){e.transitionTo(f),t.flush
(),expect(e.is(f)).toBe(!0),expect(e.is(f,null)).toBe(!0),expect(e.is("A")).toBe(!0),expect(e.is(l)).
toBe(!1)})),it("should return undefined when queried state does not exist",inject(function(e){expect(
e.is("Z")).toBeUndefined()})),it("should return true when the current state is passed with matching parameters"
,inject(function(e,t){e.transitionTo(h,{x:"foo",y:"bar"}),t.flush(),expect(e.is(h)).toBe(!0),expect(e
.is(h,{x:"foo",y:"bar"})).toBe(!0),expect(e.is("D",{x:"foo",y:"bar"})).toBe(!0),expect(e.is(h,{x:"bar"
,y:"foo"})).toBe(!1)})),it("should work for relative states",inject(function(e,t){var n={relative:e.get
("about")};e.transitionTo("about.person"),t.flush(),expect(e.is(".person",undefined,n)).toBe(!0),e.transitionTo
("about.person",{person:"bob"}),t.flush(),expect(e.is(".person",{person:"bob"},n)).toBe(!0),expect(e.
is(".person",{person:"john"},n)).toBe(!1),n.relative=e.get("about.person.item"),expect(e.is("^",undefined
,n)).toBe(!0)}))}),describe(".includes()",function(){it("should return true when the current state is passed"
,inject(function(e,t){e.transitionTo(f),t.flush(),expect(e.includes(f)).toBe(!0),expect(e.includes("A"
)).toBe(!0),expect(e.includes(l)).toBe(!1)})),it("should return true when the current state's parent is passed"
,inject(function(e,t){e.transitionTo("about.person.item"),t.flush(),expect(e.includes("about")).toBe(!0
),expect(e.includes("about.person")).toBe(!0),expect(e.includes("about.sidebar")).toBe(!1)})),it("should return undefined when queried state does not exist"
,inject(function(e){expect(e.includes("Z")).toBeUndefined()})),it("should return true when the current state is passed with partial matching parameters"
,inject(function(e,t){e.transitionTo(h,{x:"foo",y:"bar"}),t.flush(),expect(e.includes(h,{x:"foo"})).toBe
(!0),expect(e.includes(h,{y:"bar"})).toBe(!0),expect(e.includes("D",{x:"foo"})).toBe(!0),expect(e.includes
(h,{y:"foo"})).toBe(!1)})),it("should return true when the current state is passed with partial matching parameters from state's parent"
,inject(function(e,t){e.transitionTo("about.person.item",{person:"bob",id:5}),t.flush(),expect(e.includes
("about.person",{person:"bob"})).toBe(!0),expect(e.includes("about.person",{person:"steve"})).toBe(!1
)})),it("should return true when the current state is passed with partial glob patterns",inject(function(
e,t){e.transitionTo("about.person.item",{person:"bob",id:5}),t.flush(),expect(e.includes("*.person.*"
)).toBe(!0),expect(e.includes("*.person.**")).toBe(!0),expect(e.includes("**.item.*")).toBe(!1),expect
(e.includes("**.item")).toBe(!0),expect(e.includes("**.stuff.*")).toBe(!1),expect(e.includes("*.*.*")
).toBe(!0),expect(e.includes("about.*.*")).toBe(!0),expect(e.includes("about.**")).toBe(!0),expect(e.
includes("*.about.*")).toBe(!1),expect(e.includes("about.*.*",{person:"bob"})).toBe(!0),expect(e.includes
("about.*.*",{person:"shawn"})).toBe(!1)})),it("should work for relative states",inject(function(e,t)
{e.transitionTo("about.person.item",{person:"bob",id:5}),t.flush(),expect(e.includes(".person",undefined
,{relative:"about"})).toBe(!0),expect(e.includes(".person",null,{relative:"about"})).toBe(!0),expect(
e.includes("^",undefined,{relative:e.get("about.person.item")})).toBe(!0),expect(e.includes(".person"
,{person:"bob"},{relative:e.get("about")})).toBe(!0),expect(e.includes(".person",{person:"steve"},{relative
:e.get("about")})).toBe(!1)}))}),describe(".current",function(){it("is always defined",inject(function(
e){expect(e.current).toBeDefined()})),it("updates asynchronously as the transitionTo() promise is resolved"
,inject(function(e,t){var n=e.transitionTo(f,{});expect(e.current).not.toBe(f),t.flush(),expect(e.current
).toBe(f)}))}),describe("$current",function(){it("is always defined",inject(function(e){expect(e.$current
).toBeDefined()})),it("wraps the raw state object",inject(function(e){T(f),expect(e.$current.data).toBe
(f.data)}))}),describe(".params",function(){it("is always defined",inject(function(e){expect(e.params
).toBeDefined(),expect(angular.isObject(e.params)).toBe(!0)})),it("contains the parameter values for the current state"
,inject(function(e,t){T(h,{x:"x value",z:"invalid value"}),expect(e.params).toEqual({x:"x value",y:null
})}))}),describe(".transition",function(){it("is null when no transition is taking place",inject(function(
e,t){expect(e.transition).toBeNull(),e.transitionTo(f,{}),t.flush(),expect(e.transition).toBeNull()})
),it("is the current transition",inject(function(e,t){var n=e.transitionTo(f,{});expect(e.transition)
.toBe(n)}))}),describe(".href()",function(){it("aborts on un-navigable states",inject(function(e){expect
(e.href("A")).toBeNull(),expect(e.href("about.sidebar",null,{lossy:!1})).toBeNull()})),it("generates a parent state URL when lossy is true"
,inject(function(e){expect(e.href("about.sidebar",null,{lossy:!0})).toEqual("#/about")})),it("generates a URL without parameters"
,inject(function(e){expect(e.href("home")).toEqual("#/"),expect(e.href("about",{})).toEqual("#/about"
),expect(e.href("about",{foo:"bar"})).toEqual("#/about")})),it("generates a URL with parameters",inject
(function(e){expect(e.href("about.person",{person:"bob"})).toEqual("#/about/bob"),expect(e.href("about.person.item"
,{person:"bob",id:null})).toEqual("#/about/bob/")})),it("inherit url parameters from current url",inject
(function(e){T(e.get("root"),{param1:1}),expect(e.href("root",{},{})).toEqual("#/root?param1=1"),expect
(e.href("root",{},{inherit:!1})).toEqual("#/root"),expect(e.href("root",{},{inherit:!0})).toEqual("#/root?param1=1"
)})),it("generates absolute url when absolute is true",inject(function(e){expect(e.href("about.sidebar"
,null,{absolute:!0})).toEqual("http://server/#/about"),t.html5Mode(!0),expect(e.href("about.sidebar",
null,{absolute:!0})).toEqual("http://server/about")})),it("respects $locationProvider.hashPrefix()",inject
(function(e){t.hashPrefix("!"),expect(e.href("home")).toEqual("#!/")})),describe("when $browser.baseHref() exists"
,function(){beforeEach(inject(function(e){spyOn(e,"baseHref").andCallFake(function(){return"/base/"})
})),it("does not prepend relative urls",inject(function(e){expect(e.href("home")).toEqual("#/")})),it
("prepends absolute urls",inject(function(e){expect(e.href("home",null,{absolute:!0})).toEqual("http://server/base/#/"
)})),it("prepends relative and absolute urls in html5Mode",inject(function(e){t.html5Mode(!0),expect(
e.href("home")).toEqual("/base/"),expect(e.href("home",null,{absolute:!0})).toEqual("http://server/base/"
)}))})}),describe(".get()",function(){it("should return the state's config",inject(function(e){expect
(e.get("home").url).toBe("/"),expect(e.get("home.item").url).toBe("front/:id"),expect(e.get("A")).toBe
(f),expect(e.get("Z")).toBeNull()})),it("should return all of the state's config",inject(function(e){
var t=e.get().sort(function(e,t){return(e.name>t.name)-(t.name>e.name)}),n=["","A","B","C","D","DD","DDDD"
,"E","H","HH","HHH","OPT","OPT.OPT2","RS","about","about.person","about.person.item","about.sidebar","about.sidebar.item"
,"badParam","badParam2","dynamicController","first","home","home.item","home.redirect","json","resolveFail"
,"resolveTimeout","root","root.sub1","root.sub2","second"];expect(t.map(function(e){return e.name})).
toEqual(n)})),it("should work for relative states",inject(function(e){var t=e.get("about"),n=e.get(".person"
,t);expect(n.url).toBe("/:person"),expect(e.get("^","about.person").url).toBe("/about");var r=e.get(".person.item"
,t);expect(r.url).toBe("/:id"),expect(e.get("^.^",r).url).toBe("/about")})),it("should return undefined on invalid state query"
,inject(function(e){expect(e.get(null)).toBeNull(),expect(e.get(!1)).toBeNull(),expect(e.get(undefined
)).toBeNull()}))}),describe("optional parameters",function(){it("should be populated during transition, if unspecified"
,inject(function(e,t){var n;e.get("OPT").onEnter=function(e){n=e},e.go("OPT"),t.flush(),expect(e.current
.name).toBe("OPT"),expect(e.params).toEqual({param:"100"}),expect(n).toEqual({param:"100"})})),it("should allow null default value for non-url params"
,inject(function(e,t){e.go("D"),t.flush(),expect(e.current.name).toBe("D"),expect(e.params).toEqual({
x:null,y:null})})),it("should allow arbitrary objects to pass for non-url params",inject(function(e,t
){e.go("D",{x:100,y:{foo:"bar"}}),t.flush(),expect(e.current.name).toBe("D"),expect(e.params).toEqual
({x:100,y:{foo:"bar"}})})),it("should be populated during primary transition, if unspecified",inject(
function(e,t){var n=0;e.get("OPT").onEnter=function(e){n++},e.go("OPT"),t.flush(),expect(e.current.name
).toBe("OPT"),expect(e.params).toEqual({param:"100"}),expect(n).toEqual(1)})),it("should allow mixed URL and config params"
,inject(function(e,t){var n=0;e.get("OPT").onEnter=function(e){n++},e.get("OPT.OPT2").onEnter=function(
e){n++},e.go("OPT"),t.flush(),expect(e.current.name).toBe("OPT"),expect(e.params).toEqual({param:"100"
}),expect(n).toEqual(1),e.go("OPT.OPT2",{param2:200}),t.flush(),expect(e.current.name).toBe("OPT.OPT2"
),expect(e.params).toEqual({param:"100",param2:"200",param3:"300",param4:"400"}),expect(n).toEqual(2)
}))}),xdescribe("non-optional parameters",function(){it("should cause transition failure, when unspecified."
,inject(function(e,t){var n=0;e.get("OPT").onEnter=function(){n++},e.get("OPT.OPT2").onEnter=function(
){n++},e.go("OPT"),t.flush(),expect(e.current.name).toBe("OPT"),expect(e.params).toEqual({param:"100"
}),expect(n).toEqual(1);var r;e.go("OPT.OPT2").then(function(e){r=e}),t.flush(),expect(e.current.name
).toBe("OPT"),expect(e.params).toEqual({param:"100"}),expect(r).toEqual("asdfasdf"),expect(n).toEqual
(1)}))}),describe("url handling",function(){it("should transition to the same state with different parameters"
,inject(function(e,t,n){n.path("/about/bob"),t.$broadcast("$locationChangeSuccess"),t.$apply(),expect
(e.params).toEqual({person:"bob"}),expect(e.current.name).toBe("about.person"),n.path("/about/larry")
,t.$broadcast("$locationChangeSuccess"),t.$apply(),expect(e.params).toEqual({person:"larry"}),expect(
e.current.name).toBe("about.person")})),it("preserve hash",inject(function(e,t,n){n.path("/about/bob"
),n.hash("frag"),t.$broadcast("$locationChangeSuccess"),t.$apply(),expect(e.params).toEqual({person:"bob"
}),expect(e.current.name).toBe("about.person"),expect(n.path()).toBe("/about/bob"),expect(n.hash()).toBe
("frag")})),it("should correctly handle absolute urls",inject(function(e,t,n){n.path("/first/subpath"
),t.$broadcast("$locationChangeSuccess"),t.$apply(),expect(e.current.name).toBe("first"),e.transitionTo
("second"),t.$apply(),expect(e.current.name).toBe("second"),expect(n.path()).toBe("/second")})),it("should ignore bad urls"
,inject(function(e,t,n){n.path("/first/second"),t.$broadcast("$locationChangeSuccess"),t.$apply(),expect
(e.current.name).toBe("")})),describe("typed parameter handling",function(){function t(e,t,n,r){return function(
i,s,o,u,a){e.go(i,extend({},a,o)),n.flush(),expect(e.current.name).toBe(i.name||i),expect(e.params).toEqual
(extend({},u,o,a)),expect(r.url()).toBe(s),T(f),r.url(s),t.$broadcast("$locationChangeSuccess"),n.flush
(),expect(e.current.name).toBe(i.name||i),expect(e.params).toEqual(extend({},u,o)),expect(r.url()).toBe
(s)}}beforeEach(function(){e.state({name:"types",url:"/types/{p1:string}/{p2:date}",params:{p1:{value
:["defaultValue"],array:!0},p2:new Date(2014,10,15),nonurl:null}}),e.state({name:"types.substate",url
:"/sub/{p3[]:int}/{p4:json}?{p5:bool}",params:{"p3[]":[10]}})}),it("should initialize parameters without a hacky empty test"
,inject(function(e,t){new UrlMatcher("")})),it("should ignore bad url parameters",inject(function(e,t
,n,r){n.path("/bad/5"),t.$broadcast("$locationChangeSuccess"),t.$apply(),expect(e.current.name).toBe("badParam"
),e.transitionTo("about"),t.$apply(),expect(e.current.name).toBe("about"),n.path("/bad/foo"),t.$broadcast
("$locationChangeSuccess"),t.$apply(),expect(e.current.name).toBe("about")})),it("should ignore bad state parameters"
,inject(function(e,t,n,r){e.go("badParam",{param:5}),t.$apply(),expect(e.current.name).toBe("badParam"
),expect(r).toEqual({param:5}),e.go("badParam2",{param:"12345"}),t.$apply(),expect(e.current.name).toBe
("badParam2"),e.go("about"),t.$apply(),expect(e.current.name).toBe("about"),e.go("badParam",{param:"foo"
}),t.$apply(),expect(e.current.name).toBe("about"),e.go("badParam2",{param:"1234"}),t.$apply(),expect
(e.current.name).toBe("about")})),it("should map to/from the $location.url() and $stateParams",inject
(function(e,n,r,i){var s=new Date(2014,10,15),o={p1:["defaultValue"],p2:s,nonurl:null},u={p1:["foo"],
p2:s},a={nonurl:{foo:"bar"}},f=t(e,i,r,n);f("types","/types/defaultValue/2014-11-15",{},o),f("types","/types/foo/2014-11-15"
,u,o,a),extend(o,{"p3[]":[10]}),extend(u,{p4:{baz:"qux"}}),f("types.substate","/types/foo/2014-11-15/sub/10/%7B%22baz%22:%22qux%22%7D"
,u,o,a),extend(u,{p5:!0}),f("types.substate","/types/foo/2014-11-15/sub/10/%7B%22baz%22:%22qux%22%7D?p5=1"
,u,o,a)}))}),it("should revert to last known working url on state change failure",inject(function(e,t
,n,r){e.transitionTo("about"),r.flush(),n.path("/resolve-fail"),t.$broadcast("$locationChangeSuccess"
),t.$apply(),expect(e.current.name).toBe("about")})),it("should not revert to last known working url on state change failure"
,inject(function(e,t,n,r){e.transitionTo("about"),r.flush(),t.$on("$stateChangeError",function(e){e.defaultPrevented=!0
}),n.path("/resolve-fail"),t.$broadcast("$locationChangeSuccess"),t.$apply(),expect(n.path()).toBe("/resolve-fail"
)})),it('should replace browser history when "replace" enabled',inject(function(e,t,n,r){spyOn(n,"replace"
),e.transitionTo("about",{},{location:"replace"}),r.flush(),expect(n.replace).toHaveBeenCalled()})),it
("should not replace history normally",inject(function(e,t,n,r){spyOn(n,"replace"),e.transitionTo("about"
),r.flush(),expect(n.replace).not.toHaveBeenCalled()}))}),describe("default properties",function(){it
("should always have a name",inject(function(e,t){e.transitionTo(f),t.flush(),expect(e.$current.name)
.toBe("A"),expect(e.$current.toString()).toBe("A")})),it("should always have a resolve object",inject
(function(e){expect(e.$current.resolve).toEqual({})}))}),describe('"data" property inheritance/override'
,function(){it("should stay immutable for if state doesn't have parent",inject(function(e){T(m),expect
(e.current.name).toEqual("H"),expect(e.current.data.propA).toEqual(m.data.propA),expect(e.current.data
.propB).toEqual(m.data.propB)})),it("should be inherited from parent if state doesn't define it",inject
(function(e){T(g),expect(e.current.name).toEqual("HH"),expect(e.current.data.propA).toEqual(m.data.propA
),expect(e.current.data.propB).toEqual(m.data.propB)})),it("should be overridden/extended if state defines it"
,inject(function(e){T(y),expect(e.current.name).toEqual("HHH"),expect(e.current.data.propA).toEqual(y
.data.propA),expect(e.current.data.propB).toEqual(m.data.propB),expect(e.current.data.propB).toEqual(
g.data.propB),expect(e.current.data.propC).toEqual(y.data.propC)}))}),describe("substate and stateParams inheritance"
,function(){it("should inherit the parent param",inject(function(e,t,n){T(e.get("root"),{param1:1}),e
.go("root.sub1",{param2:2}),n.flush(),expect(e.current.name).toEqual("root.sub1"),expect(t).toEqual({
param1:"1",param2:"2"})})),it("should not inherit siblings' states",inject(function(e,t,n){T(e.get("root"
),{param1:1}),e.go("root.sub1",{param2:2}),n.flush(),expect(e.current.name).toEqual("root.sub1"),e.go
("root.sub2"),n.flush(),expect(e.current.name).toEqual("root.sub2"),expect(t).toEqual({param1:"1",param2
:undefined})}))}),describe("html5Mode compatibility",function(){it("should generate non-hashbang URLs in HTML5 mode"
,inject(function(e){expect(e.href("about.person",{person:"bob"})).toEqual("#/about/bob"),t.html5Mode(!0
),expect(e.href("about.person",{person:"bob"})).toEqual("/about/bob")}))}),describe("default properties"
,function(){it("should always have a name",inject(function(e,t){e.transitionTo(f),t.flush(),expect(e.
$current.name).toBe("A"),expect(e.$current.toString()).toBe("A")})),it("should always have a resolve object"
,inject(function(e){expect(e.$current.resolve).toEqual({})})),it("should include itself and parent states"
,inject(function(e,t){e.transitionTo(p),t.flush(),expect(e.$current.includes).toEqual({"":!0,D:!0,DD:!0
})}))}),describe("template handling",function(){it("should inject $stateParams into templateUrl function"
,inject(function(e,t,r){r.expectGET("/templates/foo.html").respond("200"),e.transitionTo("about.sidebar.item"
,{item:"foo"}),t.flush(),expect(n).toEqual({item:"foo"})}))}),describe("provider decorators",function(
){it("should return built-in decorators",inject(function(t){expect(e.decorator("parent")({parent:f}).
self.name).toBe("A")})),it("should allow built-in decorators to be overridden",inject(function(t,n){e
.decorator("data",function(e){return angular.extend(e.data||{},{foo:"bar"})}),e.state("AA",{parent:f,
data:{baz:"true"}}),t.transitionTo("AA"),n.flush(),expect(t.current.data).toEqual({baz:"true",foo:"bar"
})})),it("should allow new decorators to be added",inject(function(t,n){e.decorator("custom",function(
e){return function(){return"Custom functionality for state '"+e+"'"}}),e.state("decoratorTest",{}),t.
transitionTo("decoratorTest"),n.flush(),expect(t.$current.custom()).toBe("Custom functionality for state 'decoratorTest'"
)})),it("should allow built-in decorators to be extended",inject(function(t,n,r){e.decorator("views",
function(e,t){var n={};return angular.forEach(t(e),function(e,t){n[t]=angular.extend(e,{templateProvider
:function(){return"Template for "+t}})}),n}),e.state("viewTest",{views:{viewA:{},viewB:{}}}),t.transitionTo
("viewTest"),n.flush(),expect(t.$current.views["viewA@"].templateProvider()).toBe("Template for viewA@"
),expect(t.$current.views["viewB@"].templateProvider()).toBe("Template for viewB@")}))})}),describe("state queue"
,function(){angular.module("ui.router.queue.test",["ui.router.queue.test.dependency"]).config(function(
e){e.state("queue-test-a",{}).state("queue-test-b-child",{parent:"queue-test-b"}).state("queue-test-b"
,{})}),angular.module("ui.router.queue.test.dependency",[]).config(function(e){e.state("queue-test-a.child"
,{})});var e=["","queue-test-a","queue-test-a.child","queue-test-b","queue-test-b-child"];it("should work across modules"
,function(){module("ui.router.queue.test","ui.router.queue.test.dependency"),inject(function(t){var n=
t.get().sort(function(e,t){return(e.name>t.name)-(t.name>e.name)});expect(n.map(function(e){return e.
name})).toEqual(e)})}),it("should work when parent is name string",function(){module("ui.router.queue.test"
,"ui.router.queue.test.dependency"),inject(function(t){var n=t.get().sort(function(e,t){return(e.name>
t.name)-(t.name>e.name)});expect(n.map(function(e){return e.name})).toEqual(e)})})});